<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Environmental Source Apportionment Toolkit (ESAT) &mdash; Environmental Source Apportionment Toolkit (ESAT) 0.1a documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=88a2ef70"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python API" href="docs/modules.html" />
    <link rel="prev" title="Welcome to EPA’s ESAT Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Environmental Source Apportionment Toolkit (ESAT)
          </a>
              <div class="version">
                2024
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to EPA’s ESAT Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Environmental Source Apportionment Toolkit (ESAT)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#background">Background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#esat-predecessor">ESAT Predecessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notebooks">Notebooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#development">Development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rust-compiling">Rust Compiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-docs">Creating Docs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-wheels-and-compiling-rust">Building Wheels and Compiling Rust</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-tests">Code Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#community-contributions">Community Contributions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docs/modules.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/cli.html">Command Line Interface</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Environmental Source Apportionment Toolkit (ESAT)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Environmental Source Apportionment Toolkit (ESAT)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="environmental-source-apportionment-toolkit-esat">
<h1>Environmental Source Apportionment Toolkit (ESAT)<a class="headerlink" href="#environmental-source-apportionment-toolkit-esat" title="Link to this heading"></a></h1>
<p>Last Update: 08-15-2024</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#description"><span class="xref myst">Description</span></a></p></li>
<li><p><a class="reference internal" href="#background"><span class="xref myst">Background</span></a></p>
<ul>
<li><p><a class="reference internal" href="#esat-predecessor"><span class="xref myst">ESAT Predecessor</span></a></p></li>
<li><p><a class="reference internal" href="#features"><span class="xref myst">Features</span></a></p></li>
<li><p><a class="reference internal" href="#notebooks"><span class="xref myst">Notebooks</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#development"><span class="xref myst">Development</span></a></p>
<ul>
<li><p><a class="reference internal" href="#requirements"><span class="xref myst">Requirements</span></a></p></li>
<li><p><a class="reference internal" href="#rust-compiling"><span class="xref myst">Rust Compiling</span></a></p></li>
<li><p><a class="reference internal" href="#creating-docs"><span class="xref myst">Creating Docs</span></a></p></li>
<li><p><a class="reference internal" href="#building-wheels-and-compiling-rust"><span class="xref myst">Building Wheels and Compiling Rust</span></a></p></li>
<li><p><a class="reference internal" href="#code-tests"><span class="xref myst">Code Tests</span></a></p></li>
<li><p><a class="reference internal" href="#community-contributions"><span class="xref myst">Community Contributions</span></a></p></li>
</ul>
</li>
</ul>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h2>
<p>The Environmental Source Apportionment Toolkit (ESAT) is an open-source software package that provides API and CLI
functionality to create source apportionment workflows specifically targeting environmental datasets. Source
apportionment in environment science is the process of mathematically estimating the profiles and contributions of
multiple sources in some dataset, and in the case of ESAT, while considering data uncertainty. There are many potential
use cases for source apportionment in environmental science research, such as in the fields of air quality, water
quality and potentially many others.</p>
<p>The ESAT toolkit is written in Python and Rust, and uses common packages such as numpy, scipy and pandas for data
processing. The source apportionment algorithms provided in ESAT include two variants of non-negative matrix
factorization (NMF), both of which have been written in Rust and contained within the python package. A collection of
data processing and visualization features are included for data and model analytics. The ESAT package includes a
synthetic data generator and comparison tools to evaluate ESAT model outputs.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading"></a></h2>
<section id="esat-predecessor">
<h3>ESAT Predecessor<a class="headerlink" href="#esat-predecessor" title="Link to this heading"></a></h3>
<p>A widely used application used for environmental source apportionment is the EPA’s Positive Matrix Factorization version
5 (PMF5), which is a broadly used tool with an international user community. The PMF5 application is a mathematical tool
that processes a dataset of feature concentrations across many samples (and concentration uncertainties) to estimate a
set of source profiles and their contributions. PMF5 can be used on a wide range of environmental data and is a powerful
tool for estimating source apportionment:
https://www.epa.gov/air-research/positive-matrix-factorization-model-environmental-data-analyses</p>
<p>PMF5 was released in 2014 and is no longer being supported. The math engine used in PMF5 is proprietary and the source
code has not been made public. One of the primary purposes of ESAT was to recreate the source apportionment workflow and
mathematics as an open-source software package to offer a modernized option for environmental source apportionment.
Other reasons for developing ESAT was to offer increased maintainability, development efficient, thorough documentation,
modern optimizations, new features and customized workflows for novel use cases.</p>
</section>
<section id="features">
<h3>Features<a class="headerlink" href="#features" title="Link to this heading"></a></h3>
<p>ESAT python package focuses on source apportionment estimates using NMF algorithms. These
algorithms are implemented both in python using numpy functions and in Rust (default) for an optimization option. The
two currently available are:</p>
<ol class="arabic simple">
<li><p>LS-NMF: Least-squares NMF, a well documented and widely uses NMF algorithm. The ls-nmf algorithm is available in the NMF R package.</p></li>
<li><p>WS-NMF: Weight-Semi NMF, a variant of the NMF algorithm which allows for negative values in both the input data matrix and in the factor contribution matrix.</p></li>
</ol>
<p>Source apportionment solution error estimation methods are also available, which are the same methods that are found in PMF5.
These are:</p>
<ol class="arabic simple">
<li><p>Bootstrap (BS): the input dataset is divided into multiple blocks and randomly reassembled to attempt to quantify the variability in the factor profiles and contributions.</p></li>
<li><p>Displacement (DISP): the solution factor profiles are all individually shifted (both increased and decreased) to determine the amount of change required for the loss value to reach specific dQ (change in Q) values.</p></li>
<li><p>Bootstrap-Displacement (BS-DISP): the combination of the two error estimation methods. Where for each Bootstrap dataset/model, all or targeted factor profile values are adjusted using the DISP method.</p></li>
</ol>
<p>ESAT includes constrained models, as found in PMF5, where selecting a source apportionment model there is the option to add constraints through defining specific value constraints or define value correlations as a collection of linear equations.</p>
<p>Lastly, ESAT includes a data simulator which allows for random or use defined synthetic source profiles and contributions to be used in ESAT to evaluating how well the original synthetic data can be recreated.</p>
</section>
<section id="notebooks">
<h3>Notebooks<a class="headerlink" href="#notebooks" title="Link to this heading"></a></h3>
<p>Juypter notebooks are available that demonstrate the complete source apportionment and error estimation workflow found in PMF5, demonstrated in notebooks/epa_esat_workflow_01.ipynb</p>
<p>The simulator notebook provides examples for creating the synthetic profiles and contributions dataset and using the evaluation features to see how ‘well’ ESAT can recreate those profiles and contributions.</p>
<p>Other notebooks are included which were used during development and verifying visualizations.</p>
</section>
</section>
<section id="development">
<h2>Development<a class="headerlink" href="#development" title="Link to this heading"></a></h2>
<section id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Core ESAT python package requirements can be found in the requirements.txt file.</p></li>
<li><p>The python requirements for creating the code documentation can be found in the doc-requirements.txt file.</p></li>
<li><p>Full development python package requirements can be found in the _dev-requirements.txt file (not actively maintained).</p></li>
</ul>
<p>The ESAT python codebase includes github workflow actions which run:</p>
<ol class="arabic simple">
<li><p>Run python build to compile the Rust code and create python packages for python 3.10, 3.11 and 3.12 on Linux, Windows and MacOS.</p></li>
<li><p>Recreate code documentation from the README.md file, code docstrings for the Python API and CLI. Documentation is used to update the github documentation site for ESAT.</p></li>
</ol>
</section>
<section id="rust-compiling">
<h3>Rust Compiling<a class="headerlink" href="#rust-compiling" title="Link to this heading"></a></h3>
<p>The python package includes a Rust module for running the algorithm update procedures, which requires local compiling to execute.</p>
<p>To run the Rust functions that is specified by the optimized parameter, requires that Rust is installed (https://www.rust-lang.org/tools/install) and the python package maturin (https://pypi.org/project/maturin/) is installed to the python development environment.
Then from the python env and the project root, executing <i>maturin develop</i> will compile the Rust code and place it in your python environment path. To compile optimized Rust code, include the <i>-r</i> or <i>–release</i> tags.</p>
<p>The Rust code can also be compiled to the target directory inside of project root using <i>maturin build</i>.</p>
<p>The rust functions are imported as python functions, with the ‘from esat_rust import esat_rust’.</p>
<p>When creating the python package the pyproject.toml specifies that both setuptools and setuptool-rust are used. Setuptools-rust is required for compiling the Rust code during package build.</p>
</section>
<section id="creating-docs">
<h3>Creating Docs<a class="headerlink" href="#creating-docs" title="Link to this heading"></a></h3>
<p>The documentation is created using sphinx and several extensions.</p>
<p>To create or add new rst files run <i>sphinx-apidoc -o docs esat</i>.</p>
<p>To create, update or modify the existing documentation html, run
<i>sphinx-build -M html . docs</i> from the command line at the project root directory running the python environment with the necessary sphinx packages.</p>
</section>
<section id="building-wheels-and-compiling-rust">
<h3>Building Wheels and Compiling Rust<a class="headerlink" href="#building-wheels-and-compiling-rust" title="Link to this heading"></a></h3>
<p>The ESAT python package and cli are built using setuptools and setuptools-rust, with configuration details defined in pyproject.toml and Cargo.toml.</p>
<p>The python package can be built with the standard <i>python -m build</i> from the project root directory.</p>
<p>Build will compile the rust code and package up the python
code combining them into the wheel for distribution. The resulting wheel with the compiled code is available on github as a workflow artifact for the targeted architecture and python version.</p>
<p>The python package will be available on pypi.org in the near future.</p>
</section>
<section id="code-tests">
<h3>Code Tests<a class="headerlink" href="#code-tests" title="Link to this heading"></a></h3>
<p>A collection of pytest tests have been created to test functionality, mostly as systems tests, which can be executed as</p>
<p><i>coverage run -m pytest tests</i></p>
<p>with the coverage results displayed by</p>
<p><i>coverage report</i></p>
<p>While the overall coverage percentage is low, the majority of the untested code is for visualization functions with all
core functionality covered by tests.</p>
</section>
<section id="community-contributions">
<h3>Community Contributions<a class="headerlink" href="#community-contributions" title="Link to this heading"></a></h3>
<p>For those in the user community wishing to contribute to this project:</p>
<ul class="simple">
<li><p>Code updates can be made through pull requests that will be reviewed by repository maintainers.</p></li>
<li><p>Software, code, or algorithm related bugs and issues can be submitted directly as issues on the GitHub repository.</p></li>
<li><p>Support can be requested through GitHub issues or through email at <a class="reference internal" href="#esat&#64;epa.gov"><span class="xref myst">esat&#64;epa.gov</span></a>.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to EPA’s ESAT Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="docs/modules.html" class="btn btn-neutral float-right" title="Python API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, EPA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>